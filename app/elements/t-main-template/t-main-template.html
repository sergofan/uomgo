<link rel="import" href="../../bower_components/polymer/polymer.html">

<dom-module id="t-main-template">
	<template>
		<style is="custom-style" include="shared-styles">
			:host {
				display: block;
				word-wrap: break-word;
				margin: 32px 0;
			}
			.yellow-button {
				text-transform: none;
				color: #eeff41;
			}
			#collapsePanel {
				background-color: #00E676;
				position: fixed;
				top: calc(50vh - 68px);
				right: -178px;
				width: 200px;
				height: 134px;
				border-radius: 8px 0 0 8px;
				border: 1px solid #ddd;
				box-shadow: 0 8px 10px 1px rgba(0, 0, 0, 0.14),
										0 3px 14px 2px rgba(0, 0, 0, 0.12),
										0 5px 5px -3px rgba(0, 0, 0, 0.4);
				font-weight: 500;
				-webkit-transition: right 0.5s;
				transition: right 0.5s;
				cursor: pointer;
				z-index: 1001;
			}
			#collapsePanel:hover {
				right: 0px;
			}
			#verticalText {
				position: absolute;
				height: 100%;
				width: 134px;
				margin: 4px;
				transform: rotate(-90deg);
				align-self: center;
				text-align: center;
			}
		</style>

		<x-route route="{{route}}"></x-route>

		<div id="collapsePanel" class="layout horizontal">
			<div id="verticalText">
				План работы УОМГО
			</div>
			<div class="content layout vertical center-center">
				<paper-button on-tap="goToDocs" raised
											style="margin-left: 32px; text-align: center;">
					Перейти в раздел документы
					<iron-icon icon="arrow-forward"></iron-icon></paper-button>
			</div>
		</div>

		<firebase-document id="firebaseDocument"
											 app-name="uomgo"></firebase-document>

		<x-messages></x-messages>
		<x-posts limit-to-first="[[limitToFirst]]"
						 limit-to-last="[[limitToLast]]"
						 start-at="[[startAt]]"
						 end-at="[[endAt]]"
						 user="[[user]]"></x-posts>

		<template is="dom-if" if="[[user]]">
			<paper-fab id="add"
								 icon="add"
								 mini="true"
								 class="green"
								 style="position:fixed;bottom:48px;right:16px;"></paper-fab>
		</template>

		<x-post-edit-dialog></x-post-edit-dialog>

	</template>
	<script>
	(function() {
		'use strict';

		Polymer({
			is: 't-main-template',
			properties: {
				limitToLast: {
					type: Number,
					notify: true,
				},
				limitToFirst: {
					type: Number,
					notify: true,
				},
				startAt: {
					type: String,
					notify: true
				},
				endAt: {
					type: String,
					notify: true,
				},
				dataDB: {
					type: Object,
					observer: 'dataChanged',
					notify: true
				},
				postData: {
					type: Object,
					value: {}
				},
				key: {
					type: String,
					value: ''
				},
				user: {
					type: Object
				}
			},
			ready: function() {
				var firebaseDocument = this.$.firebaseDocument;
				// var toastMessage = this.$.toastMessage;
				// toastMessage.fitInto = this.$.toastMessageContainer;
				// setTimeout(function() {
					// this.openToast();
				// }.bind(this), 2500);

			},
			editPostDialogOpen: function(e) {
				this.postData = {};
				if (e.model !== undefined) {
					this.postData = Object.assign({}, e.model.post);
				};
				editPostDialog.toggle();
			},
			deletePostDialogOpen: function(e) {
				this.postData = {};
				if (e.model !== undefined) {
					this.postData = Object.assign({}, e.model.post);
				};
				deletePostDialog.toggle();
			},
			_savePost: function() {
				delete firebaseDocument.data;
				if ( this.postData['name'] !== undefined ) {
					firebaseDocument.data['name'] = this.postData['name'];
				};
				if ( this.postData['video-id'] !== undefined ) {
					firebaseDocument.data['video-id'] = this.postData['video-id'];
				};
				if ( this.postData['text'] !== undefined ) {
					firebaseDocument.data['text'] = this.postData['text'];
				};
				if ( this.postData['date'] !== undefined ) {
					firebaseDocument.data['date'] = this.postData['date'];
				};
				if (this.postData.$key !== undefined) {
					firebaseDocument.save("/posts", this.postData.$key);
				} else firebaseDocument.save("/posts");
			},
			_deletePost: function() {
				var key = this.postData.$key;
				firebaseDocument.data = Object.assign({}, null);
				firebaseDocument.save("/posts", key);
			},
			_computePath: function(key) {
				return "/posts/" + key;
			},
			goToDocs: function() {
				this.async(function() {
					this.set('route.path', '/about/docs');
				});
			}
			// openToast: function(event) {
				// toastMessage.open();
			// },
			// closeToast: function(event) {
				// toastMessage.close();
			// }
		});

	})();
	</script>
</dom-module>
