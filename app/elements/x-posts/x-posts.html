<link rel="import" href="../../bower_components/polymer/polymer.html">

<dom-module id="x-posts">
	<template>
		<style is="custom-style" include="shared-styles">
			:host {
				display: block;
				word-wrap: break-word;
			}
			paper-card {
				--paper-card: {
					padding: 0 16px !important;
		      @apply(--layout-flex);
		      @apply(--layout-vertical);
					text-align: center;
					/*margin: 16px auto 0 auto !important;*/
				};
				--paper-card-header-text: {
					text-align: center;
					/*max-width: 480px;*/
				};
				--paper-card-content: {
					text-align: center;
					/*@apply(--layout-wrap);
					@apply(--layout-vertical);
					@apply(--layout-center-center);*/
				};
				--paper-card-actions: {
					text-align: center;
					/*@apply(--layout-wrap);
					@apply(--layout-horizontal);
					@apply(--layout-center-justified);
					position: absolute;
					bottom: 0;
					left: 0;
					right: 0;
					padding: 16px;
					height: 24px;*/
				};
			}
			.loadingIndicator {
	      text-align: center;
	      height: 40px;
	    }
			.loadingIndicator paper-spinner {
	      width: 20px;
	      height: 20px;
	      margin-right: 10px;
	    }
			iron-list {
				/*@apply(--layout-flex-auto);*/
	      /*--iron-list-items-container: {
	      };*/
				/*padding-top: 16px;*/
	      /*margin-top: 16px;*/
	      /*padding-bottom: 16px;*/
			}
			.item {
	      @apply(--layout-horizontal);
	      padding: 16px;
	      border-radius: 8px;
	      background-color: white;
	      border: 1px solid #ddd;
	      /*margin: 16px auto 0 auto !important;*/
	    }
			.pad {
	      padding: 0 16px;
	      @apply(--layout-flex);
	      @apply(--layout-vertical);
	    }
	    .primary {
	      font-size: 16px;
	      font-weight: bold;
	    }
	    .secondary {
	      font-size: 14px;
	    }
	    .dim {
	      color: gray;
	    }
		</style>

		<firebase-query id="firebaseQueryPosts"
										path="/posts"
										app-name="uomgo"
										order-by-child="date"
										start-at="{{startAt}}"
										end-at="{{endAt}}"
										limit-to-first="[[limitToFirst]]"
										limit-to-last="[[limitToLast]]"
										order-by-child="date"
										data="{{dataDB}}"></firebase-query>

		<array-filter
				items="[[dataDB]]"
				filtered="{{filtered}}"
				sort="_computeSort"
				filter="_filter"></array-filter>

		<!-- <iron-scroll-threshold on-lower-threshold="loadMoreData" id="threshold"> -->
			<iron-list id="list" items="[[filtered]]" as="post" scroll-target="this">
				<template>
					<!-- <paper-card heading="[[post.name]]">
					  <div class="card-content">
							<template is="juicy-html"
												content$="[[post.text]]"></template>
						</div>
					</paper-card> -->
					<div class="item" tabindex$="[[tabIndex]]">
						<div class="pad">
							<div class="primary">[[index]]</div>
							<div class="secondary">[[post.name]]</div>
							<div class="secondary dim">
								<template is="juicy-html"
													content$="[[post.text]]"></template>
							</div>
						</div>
					</div>
				</template>
			</iron-list>
		<!-- </iron-scroll-threshold> -->

	</template>
	<script>
	(function() {
		'use strict';

			Polymer({
				is: 'x-posts',
				behaviors: [
					Polymer.NeonAnimationRunnerBehavior
				],
				properties: {
					animationConfig: {
						value: function() {
							return {
								'entry': [{
									name: 'cascaded-animation',
									animation: 'scale-up-animation',
									node: this,
									nodeDelay: 50,
									timing: {
										duration: 150,
										delay: 0
									}
								}]
							};
						}
					},
					user: {
						type: Object
					},
					limitToLast: {
						type: Number,
						notify: true
					},
					limitToFirst: {
						type: Number,
						notify: true,
					},
					startAt: {
						type: String,
						notify: true
					},
					endAt: {
						type: String,
						notify: true,
					}
				},

				ready: function() {
				},

				_computeSort: function(a, b) {
					if (a.date == b.date) {
						return 0;
					}
					return a.date > b.date ? -1 : 1;
				},

				_filter: function(item) {
					var todayDate = new Date();
					var todayMM = todayDate.getMonth()+1; //January is 0!
					var todayYYYY = todayDate.getFullYear();
					var itemDate = new Date(item.date);
					var itemMM = itemDate.getMonth()+1;
					var itemYYYY = itemDate.getFullYear();

					if ( itemYYYY === todayYYYY && itemMM > 8  ) {
						return true;
					};
				},

				_renderRepeat: function () {
					var xPostItems = Polymer.dom(this.root).querySelectorAll('x-post-item');
					this.animationConfig['entry'][0].nodes = Array.prototype.slice.call(xPostItems);
					this.playAnimation('entry');
				},

				_loadMoreData: function () {
					// load async stuff. e.g. XHR
			    asyncStuff(function done() {
			      ironScrollTheshold.clearTriggers();
			    });
				},

				asyncStuff: function () {
					console.log("trew");
				}

			});
	})();
	</script>
</dom-module>
