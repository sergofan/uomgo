<link rel="import" href="../../bower_components/polymer/polymer.html">

<dom-module id="x-posts">
	<template>
		<style is="custom-style" include="shared-styles">
			:host {
				display: block;
			}
			paper-card {
				--paper-card: {
					text-align: center;
				};
				--paper-card-header-text: {
					/*max-width: 480px;*/
					text-align: center;
				};
				--paper-card-content: {
					/*@apply(--layout-wrap);
					@apply(--layout-vertical);
					@apply(--layout-center-center);*/
					text-align: center;
				};
				--paper-card-actions: {
					/*@apply(--layout-wrap);
					@apply(--layout-horizontal);
					@apply(--layout-center-justified);
					position: absolute;
					bottom: 0;
					left: 0;
					right: 0;
					padding: 16px;
					height: 24px;*/
					text-align: center;
				};
			}
			.loadingIndicator {
	      text-align: center;
	      height: 40px;
	    }
			.loadingIndicator paper-spinner {
	      width: 20px;
	      height: 20px;
	      margin-right: 10px;
	    }
			iron-list {
	      /*padding-top: 64px;*/
	      padding-bottom: 16px;
	      --iron-list-items-container: {
	        /*max-width: 800px;
	        margin: auto;
	        margin-top: 60px;
	        margin-bottom: 10px;*/
	      };
	    }
		</style>

		<firebase-query id="firebaseQueryPosts"
										path="/posts"
										app-name="uomgo"
										order-by-child="date"
										start-at="{{startAt}}"
										end-at="{{endAt}}"
										limit-to-first="[[limitToFirst]]"
										limit-to-last="[[limitToLast]]"
										order-by-child="date"
										data="{{dataDB}}"></firebase-query>

		<array-filter
				items="[[dataDB]]"
				filtered="{{filtered}}"
				sort="_computeSort"
				filter="_filter"></array-filter>

		<!-- <iron-scroll-threshold on-lower-threshold="loadMoreData" id="threshold"> -->
			<iron-list class="red-gradient" id="list" items="[[filtered]]" as="post" scroll-target="document">
				<template>
					<div>
						<div class="post" tabindex$="[[tabIndex]]">
							<div class="pad">
								<div class="primary">[[post.name]] [[index]]</div>
								<div class="secondary dim">[[post.text]]</div>
							</div>
						</div>
					</div>
				</template>
			</iron-list>
		<!-- </iron-scroll-threshold> -->

	</template>
	<script>
	(function() {
		'use strict';

			Polymer({
				is: 'x-posts',
				behaviors: [
					Polymer.NeonAnimationRunnerBehavior
				],
				properties: {
					animationConfig: {
						value: function() {
							return {
								'entry': [{
									name: 'cascaded-animation',
									animation: 'scale-up-animation',
									node: this,
									nodeDelay: 50,
									timing: {
										duration: 150,
										delay: 0
									}
								}]
							};
						}
					},
					user: {
						type: Object
					},
					limitToLast: {
						type: Number,
						notify: true
					},
					limitToFirst: {
						type: Number,
						notify: true,
					},
					startAt: {
						type: String,
						notify: true
					},
					endAt: {
						type: String,
						notify: true,
					}
				},

				ready: function() {
				},

				_computeSort: function(a, b) {
					if (a.date == b.date) {
						return 0;
					}
					return a.date > b.date ? -1 : 1;
				},

				_filter: function(item) {
					var todayDate = new Date();
					var todayMM = todayDate.getMonth()+1; //January is 0!
					var todayYYYY = todayDate.getFullYear();
					var itemDate = new Date(item.date);
					var itemMM = itemDate.getMonth()+1;
					var itemYYYY = itemDate.getFullYear();

					if ( itemYYYY === todayYYYY && itemMM > 8  ) {
						return true;
					};
				},

				_renderRepeat: function () {
					var xPostItems = Polymer.dom(this.root).querySelectorAll('x-post-item');
					this.animationConfig['entry'][0].nodes = Array.prototype.slice.call(xPostItems);
					this.playAnimation('entry');
				},

				_loadMoreData: function () {
					// load async stuff. e.g. XHR
			    asyncStuff(function done() {
			      ironScrollTheshold.clearTriggers();
			    });
				},

				asyncStuff: function () {
					console.log("trew");
				}

			});
	})();
	</script>
</dom-module>
